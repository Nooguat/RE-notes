# WannaCry

### Static

#### Strings

- Presence of `Lockit` string 

- `PlayGame` strings ; phising purpose ?

- List of months,days of the week and date format

- Charsets![](/home/gsd/.config/marktext/images/2022-09-24-16-59-29-image.png) 

- `PC NETWORK PROGRAM` ; `SMB3` ; `LANMAN`  `Windows for Workgroups` also for phising / whitelisting purpose ?

- Multiple strings that seems encrypted / encoded maybe seeds ? ![](/home/gsd/.config/marktext/images/2022-09-24-17-06-29-image.png)

- XML file ; maybe using the DOM exploit to run code ?

- `philpapi.dll` ; `MSCVP60.dll` are sus

- Some file extension ; maybe for targeting ? 
  ![](/home/gsd/.config/marktext/images/2022-09-24-17-13-00-image.png)

- `msg/<lang>` contains the message for decryption 
  ![](/home/gsd/.config/marktext/images/2022-09-24-17-14-38-image.png) 

- `http://www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com` callback address ?

#### DIE

File is PE 32 bits; compiled with Windows C++ 2000

#### PEstudio

- Ransomware typical functions : ![](/home/gsd/.config/marktext/images/2022-09-24-17-32-38-image.png)

- `CryptAcquireContext`

- `diskpart.exe` : another phishing string purpose ; binary description is Disk Defragmenter

- `cmd.exe /c "%s"` 

- `iphlpapi` : IP helper API + `ws2_32.dll` : Windows Socket librairy maybe C2 setup

#### Cutter

**analyse from the main entrypoint**

- callback to url found in strings 
  
  - True : jump to function 
  
  - False : clear some registers (exit ?)

- checkModule `GetModuleFileNameA` condition on the return value (>= 2)
  
  - True : enter function calling complete stack
  
  - False : calls to the WAPI about `ipServiceStartTable` ; service targeted is `mssecsvec2`

**analyse from the notable functions calls**

### Dynamic

#### With internet

#### Without internet

- Malware has detonated -> not checking on the callback domain ?
- Lots of register key manipulation
- TCP is trying to reconnect very often


